<!doctype html>
<html lang="en">

<head>
  <title>codemirror esm</title>

  <script type="importmap">
    {
      "imports": {
        "codemirror": "/dist/codemirror.js"
      }
    }
  </script>

  <script type="module">
    import {EditorView, minimalSetup, EditorState, autocomplete} from 'codemirror';

    const { autocompletion } = autocomplete;

    // Our list of completions (can be static, since the editor
    /// will do filtering based on context).
    const completions = [
      {label: "panic", type: "keyword"},
      {label: "park", type: "constant", info: "Test completion"},
      {label: "password", type: "variable"},
    ]

    function myCompletions(context) {
      let before = context.matchBefore(/\w+/)
      // If completion wasn't explicitly started and there
      // is no word before the cursor, don't open completions.
      if (!context.explicit && !before) return null
      return {
        from: before ? before.from : context.pos,
        options: completions,
        validFor: /^\w*$/
      }
    }


    let editor = new EditorView({
      extensions: [
        minimalSetup,
        // Transaction filters can inspect transactions and
        // add/replace them with other transactions. If a
        // transaction would have made the document more than
        // one line long, it is filtered out.
        EditorState.transactionFilter.of(tr => {
          return tr.newDoc.lines > 1 ? [] : [tr]
        }),
        autocompletion({override: [myCompletions]})

      ],
      parent: document.body,

    })


  </script>

</head>


<body>
<h1>CodeMirror ESM</h1>


</body>


</html>
